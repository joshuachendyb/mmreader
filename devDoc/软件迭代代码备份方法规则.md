# 软件迭代代码备份方法规则

**文档创建时间**: 2026-02-03 19:30:00
**更新时间**: 2026-02-04 04:10:00
**适用场景**: 代码修改、Bug修复、功能迭代
**核心原则**: 修改前必备份，备份要有意义

---

## 一、使用范围说明

### 1.1 适用场景

| 场景 | 说明 |
|------|------|
| **无Git版本控制** | 项目未使用Git或无法使用Git时的代码管理 |
| **本地开发** | 开发环境中的代码版本管理 |
| **团队协作** | 无Git环境下的代码交接和备份 |

### 1.2 适用范围

| 代码类型 | 范围 |
|---------|------|
| **前端代码** | HTML、CSS、JavaScript、资源文件 |
| **后端代码** | Go、Python、Node.js等后端代码 |
| **配置文件** | package.json、go.mod、pom.xml等 |
| **构建脚本** | build.bat、build.sh、Makefile等 |
| **文档资料** | 使用说明、架构设计、技术文档等 |
| **构建产物** | 编译后的可执行文件、依赖库 |

---

## 二、版本类型与备份要求

### 2.1 版本类型定义

| 版本类型 | 说明 | 示例 |
|---------|------|------|
| **dev版本** | 软件迭代中的自动升级版本 | v1.6.19 → v1.6.20 |
| **release版本** | 用户确定的正式发布版本 | v2.0.0 |

### 2.2 dev版本备份要求

| 项目 | 要求 |
|-----|------|
| 触发时机 | 每次代码修改前 |
| 备份内容 | 按需（只备份修改的文件） |
| 核心代码 | index.html、main.go 等核心文件 |
| 配置文件 | 只备份修改的配置文件 |

### 2.3 release版本备份要求

| 项目 | 要求 |
|-----|------|
| 触发时机 | 用户确认的里程碑版本发布时 |
| 备份内容 | 完整（源代码+构建产物+文档） |
| 源代码 | 全部源代码文件 |
| 构建产物 | 可执行文件、运行时依赖 |
| 文档 | 使用说明、架构设计等全部文档 |

### 2.4 版本类型对比

| 备份项 | dev版本 | release版本 |
|-------|---------|------------|
| 核心代码 | 按需 | ✅ 完整 |
| 配置文件 | 按需 | ✅ 完整 |
| 构建脚本 | 按需 | ✅ 完整 |
| 文档 | 按需 | ✅ 完整 |
| 可执行文件 | ✅ 完整 | ✅ 完整 |
| 依赖库 | ❌ | ✅ 必要部分 |

---

## 三、备份目录及命名规范

### 3.1 目录结构

```
项目根目录/
├── backup/                    # 备份主目录
│   ├── dev/                   # dev版本备份
│   └── release/               # release版本备份
├── src/ 或 static/            # 当前工作代码
├── release_YYYYMMDD_vX.X.X/  # 发布目录
├── bin/ 或 build/             # 构建产物
└── 配置文件                   # 项目配置文件
```

### 3.2 目录命名格式

```
backup/{dev|release}/v{版本号}_{操作描述}_{YYYYMMDD_HHMMSS}
```

### 3.3 命名组成

| 部分 | 说明 | 示例 |
|------|------|------|
| `{dev\|release}` | 版本类型 | dev / release |
| `v{版本号}` | 版本号 | v1.6.19 / v2.0.0 |
| `{操作描述}` | 操作类型 | before_fix / release_complete |
| `{时间戳}` | 操作时间 | 20260203_1852 |

### 3.4 操作描述类型

| 描述类型 | 说明 | 示例 |
|---------|------|------|
| `before_*` | 修改前备份 | before_fix, before_test |
| `after_*` | 修改后存档 | after_test, after_fix |
| `to_*` | 版本升级 | to_v2.0.0 |
| `_ok` | 验证成功 | fix_ok, test_ok |
| `_complete` | 完成状态 | release_complete |
| `_final` | 最终版本 | final_complete |

### 3.5 命名示例

```
backup/dev/v1.6.19_before_fix_20260203_1852
backup/release/v2.0.0_release_complete_20260203_1907
```

---

## 四、备份操作方法

### 4.1 操作原则

| 步骤 | 说明 |
|-----|------|
| 1. 创建目录 | 先创建带时间戳的备份目录 |
| 2. 复制文件 | 按需或完整复制文件 |
| 3. 验证备份 | 检查文件是否完整 |

### 4.2 Bash命令

```bash
# 创建备份目录
mkdir -p backup/{dev|release}/v{版本号}_{操作描述}_{时间戳}

# dev版本：只备份修改的文件
cp src/index.html backup/dev/v{版本号}_{操作描述}_{时间戳}/

# release版本：完整备份
cp -r src/ backup/release/v{版本号}_{操作描述}_{时间戳}/
cp 配置文件 package.json go.mod backup/release/v{版本号}_{操作描述}_{时间戳}/

# 创建发布目录
mkdir -p release_{YYYYMMDD}_v{版本号}
```

### 4.3 PowerShell命令

```powershell
# 创建备份目录
New-Item -ItemType Directory -Force -Path "backup\{dev|release}\v{版本号}_{操作描述}_{时间戳}"

# 复制文件（dev版本）
Copy-Item "src\index.html" "backup\dev\v{版本号}_{操作描述}_{时间戳}\"

# 完整备份（release版本）
Copy-Item "src\*" "backup\release\v{版本号}_{操作描述}_{时间戳}\" -Recurse
```

---

## 五、备份验证规则

### 5.1 验证检查

| 检查项 | dev版本 | release版本 |
|-------|---------|------------|
| 目录已创建 | ✅ | ✅ |
| 核心文件已备份 | ✅ | ✅ |
| 文件大小正常 | ✅ | ✅ |
| 可执行文件已备份 | ❌ | ✅ |
| 文档已备份 | ❌ | ✅ |

### 5.2 验证命令

```bash
# Bash: 检查备份
ls -la backup/{dev|release}/v{版本号}_{操作描述}_{时间戳}/
du -h backup/{dev|release}/v{版本号}_{操作描述}_{时间戳}/*
```

```powershell
# PowerShell: 检查备份
Get-ChildItem "backup\{dev|release}\v{版本号}_{操作描述}_{时间戳}\"
Get-ChildItem "backup\{dev|release}\v{版本号}_{操作描述}_{时间戳}\" -Recurse | Measure-Object
```

---

## 六、代码回滚规则

### 6.1 回滚时机

| 情况 | 是否需要回滚 |
|------|-------------|
| 新代码引入Bug | ✅ 需要回滚 |
| 测试失败无法快速修复 | ✅ 需要回滚 |
| 想要回到稳定版本 | ✅ 需要回滚 |
| 修复后验证通过 | ❌ 不需要 |

### 6.2 回滚命令

```bash
# Bash: 回滚单个文件
cp backup/{dev|release}/v{版本号}_{操作描述}_{时间戳}/index.html src/index.html

# Bash: 回滚整个目录
cp -r backup/{dev|release}/v{版本号}_{操作描述}_{时间戳}/* ./
```

```powershell
# PowerShell: 回滚
Copy-Item "backup\{dev|release}\v{版本号}_{操作描述}_{时间戳}\*" "." -Recurse -Force
```

---

## 七、常见错误与避免

### 7.1 错误清单

| 错误做法 | 后果 | 正确做法 |
|---------|------|---------|
| 不备份直接修改 | 改崩无法恢复 | 修改前必备份 |
| 备份目录无时间戳 | 多个备份混淆 | 加时间戳区分 |
| 只备份一个文件 | 漏掉依赖文件 | 按需/完整备份 |
| 备份后不验证 | 文件损坏不知道 | 备份后检查 |
| 所有版本都完整备份 | 浪费存储空间 | 按版本类型备份 |
| 发布版没备份依赖 | 运行时缺少依赖 | 完整备份发布版 |

### 7.2 检查清单

**修改前**:
- [ ] 备份目录已创建
- [ ] 需要备份的文件已复制

**修改后**:
- [ ] 新代码工作正常
- [ ] 备份文件可恢复

**发布前**:
- [ ] 源代码完整备份
- [ ] 构建产物已保存
- [ ] 文档已更新

---

## 八、总结

### 核心原则

```
1. 版本类型决定备份策略
   - dev版本: 按需备份
   - release版本: 完整备份

2. 修改前必备份（铁律）
   - 任何代码修改前必须备份
   - 备份要有意义（命名规范）

3. 备份要可恢复
   - 验证备份完整性
   - 记录备份位置

4. 发布版要完整
   - 源代码 + 构建产物 + 文档
   - 确保可重新构建和运行
```

### 口诀

```
版本类型要分清
dev按需release全
改之前，先备份
命名格式要规范
时间版本操作名
备份后，要验证
发布版，要完整
回滚时候不求人
```

---

**文档更新时间**: 2026-02-04 04:10:00
**创建人**: OpenCode AI Assistant
**版本**: 2.1
