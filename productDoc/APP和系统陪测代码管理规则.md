# APP和系统陪测代码管理规则

**文档版本**: 2.0 (2026-01-27 22:13:30)  
**创建时间**: 2026-01-27 19:43:39  
**升级时间**: 2026-01-27 22:13:30  
**规则级别**: 正式项目规范（与代码审查、BUG修复规则同等重要）

## 🎯 规则概述

本规则是项目开发中的重要规范之一，与代码审查规则、BUG修复规则共同构成项目质量保障体系。本规则旨在规范陪测代码的管理，确保目标代码与测试代码的清晰分离，提高项目可维护性和测试效率。

## 📁 目录结构

```
TestCode/
├── scripts/          # 测试脚本目录
│   └── test/        # 原test目录迁移至此
│       ├── unit/              # 单元测试
│       ├── integration/       # 集成测试
│       ├── system/            # 系统测试
│       ├── automation/        # 自动化测试
│       ├── performance/       # 性能测试
│       ├── security/          # 安全测试
│       ├── regression/        # 回归测试
│       ├── test-cases/        # 测试用例数据
│       ├── test-scripts/      # 测试脚本文件
│       ├── test-reports/      # 测试报告文件
│       └── test-results/      # 测试结果文件
├── data/            # 测试数据文件目录
│   ├── diversity-testing/     # 多样性测试数据
│   ├── functional-testing/    # 功能测试数据
│   ├── performance-testing/   # 性能测试数据
│   └── edge-case-testing/     # 边界条件测试数据
└── reports/         # 测试报告目录
    ├── unit-test-reports/     # 单元测试报告
    ├── integration-test-reports/ # 集成测试报告
    ├── system-test-reports/   # 系统测试报告
    └── performance-test-reports/ # 性能测试报告
```

## ⚖️ 规则执行标准

### 1. 强制性要求
- **所有新项目必须遵守**：新项目开发必须从项目初期就建立TestCode目录结构
- **现有项目限期整改**：现有项目必须在规定时间内完成测试代码迁移
- **代码审查必须检查**：代码审查时必须验证TestCode目录规范的遵守情况

### 2. 违规处理
- **轻度违规**：测试文件与目标代码轻微混淆，限期整改
- **中度违规**：测试代码严重影响目标代码结构，暂停开发进行整改
- **严重违规**：测试代码与目标代码完全混合，项目暂停，重新架构

### 3. 质量检查清单
- [ ] 目标代码目录是否纯净（仅src/目录）
- [ ] 所有测试脚本是否在TestCode/scripts/目录下
- [ ] 所有测试数据是否在TestCode/data/目录下
- [ ] 所有测试报告是否在TestCode/reports/目录下
- [ ] 测试代码是否与目标代码完全分离
- [ ] 代码审查时是否排除了TestCode目录的审查

## 🎯 目录规范

### 1. 目标代码 vs 陪测代码
- **目标代码**: `src/` 目录下的应用程序核心功能代码
- **陪测代码**: `TestCode/` 目录下的所有测试相关文件

### 2. 禁止混淆原则
- 陪测代码不能与目标代码混合存放
- 所有测试相关文件必须存放在TestCode目录下
- 目标代码目录保持纯净，仅包含应用程序核心功能

### 3. 报告分离原则
- **目标代码问题**: 在BUG修复报告主体中报告
- **陪测代码问题**: 在BUG修复报告附录中报告

## � 与其他规范的关联

### 1. 与代码审查规则的关系
- **审查范围**：代码审查仅针对目标代码（src/目录），排除TestCode目录
- **审查重点**：审查时重点关注目标代码与测试代码的分离情况
- **违规处理**：发现测试代码与目标代码混淆，视为严重违规

### 2. 与BUG修复规则的关系
- **问题分类**：BUG记录时明确区分目标代码问题和陪测代码问题
- **修复优先级**：目标代码问题优先处理，陪测代码问题次之
- **验证要求**：BUG修复验证时必须确保测试代码的正确组织

## � 文件分类

### scripts/ 目录
- 测试脚本文件 (.js, .ts)
- 测试配置文件
- 测试工具脚本

### data/ 目录  
- 测试用例数据文件 (.md, .json, .txt)
- 测试输入数据
- 测试输出数据

### reports/ 目录
- 测试执行报告
- 测试覆盖率报告
- 性能测试报告

## � 测试类型分类

### 1. 单元测试 (Unit Testing)
- **目的**: 验证单个函数或模块的正确性
- **范围**: 最小代码单元
- **执行频率**: 每次代码变更后
- **存放位置**: `TestCode/scripts/test/unit/`

### 2. 集成测试 (Integration Testing)
- **目的**: 验证模块间的交互和接口
- **范围**: 多个模块组合
- **执行频率**: 主要功能变更后
- **存放位置**: `TestCode/scripts/test/integration/`

### 3. 系统测试 (System Testing)
- **目的**: 验证整个系统的功能完整性
- **范围**: 完整应用程序
- **执行频率**: 版本发布前
- **存放位置**: `TestCode/scripts/test/system/`

### 4. 自动化测试 (Automation Testing)
- **目的**: 自动化执行重复性测试任务
- **范围**: 可自动化的测试场景
- **执行频率**: 按需或定期执行
- **存放位置**: `TestCode/scripts/test/automation/`

### 5. 性能测试 (Performance Testing)
- **目的**: 验证系统性能指标
- **范围**: 响应时间、吞吐量等
- **执行频率**: 性能优化前后
- **存放位置**: `TestCode/scripts/test/performance/`

### 6. 多样性测试 (Diversity Testing)
- **目的**: 验证系统对不同输入数据的兼容性
- **范围**: 各种文件格式、内容类型
- **执行频率**: 主要功能变更后
- **存放位置**: `TestCode/data/diversity-testing/`

### 7. 回归测试 (Regression Testing)
- **目的**: 确保修改不会破坏现有功能
- **范围**: 已测试过的功能
- **执行频率**: 每次代码修改后
- **存放位置**: `TestCode/scripts/test/regression/`

## � 测试数据管理

### 1. 数据分类原则
- **多样性测试数据**: 各种类型和格式的测试文件
- **功能测试数据**: 针对特定功能模块的测试数据
- **性能测试数据**: 用于性能评估的大数据量文件
- **边界条件数据**: 极端情况和边界值的测试数据

### 2. 数据版本管理
- **版本标识**: 每个测试数据集应有明确的版本标识
- **变更记录**: 记录测试数据的变更历史
- **兼容性检查**: 确保测试数据与目标代码版本兼容

### 3. 数据质量要求
- **真实性**: 测试数据应反映真实使用场景
- **完整性**: 测试数据应覆盖各种使用情况
- **准确性**: 测试数据应准确无误
- **可维护性**: 测试数据应易于更新和维护

## 💡 项目经验总结

### 1. 成功实践
- **MermaidReader项目**：成功将测试代码完全迁移到TestCode目录
- **代码审查效率**：目标代码审查更加专注，不受测试代码干扰
- **维护便利性**：测试代码有组织存放，便于查找和维护
- **系统性测试**：成功执行252个文件的系统性测试，覆盖内容解析、图表渲染、表格显示、图片显示等核心功能
- **多样性测试**：建立完整的多样性测试框架，验证系统对不同输入数据的兼容性
- **性能监控**：实时监控处理时间和效率，确保性能达标

### 2. 常见问题及解决方案
- **问题1**：测试代码与目标代码混淆
  - **解决方案**：建立严格的目录规范，定期检查
- **问题2**：测试报告分散存放
  - **解决方案**：统一归集到TestCode/reports/目录
- **问题3**：测试数据难以管理
  - **解决方案**：建立TestCode/data/目录分类存放
- **问题4**：测试类型分类不够细化
  - **解决方案**：建立详细的测试类型分类体系，包括单元测试、集成测试、系统测试、自动化测试、性能测试、多样性测试、回归测试等
- **问题5**：测试数据版本管理缺失
  - **解决方案**：建立测试数据版本管理和变更记录机制

### 3. 最佳实践建议
- **项目初期**：在项目创建时即建立TestCode目录结构
- **开发过程中**：每次提交代码前检查测试代码的组织情况
- **代码审查时**：将TestCode规范遵守情况作为审查重点
- **测试执行**：建立分层测试策略，从单元测试到系统测试逐步推进
- **数据管理**：对测试数据进行分类和版本管理，确保数据质量
- **工具化测试**：开发自动化测试工具，提高测试效率和准确性

### 4. 测试执行经验
- **测试覆盖率**：系统性测试应覆盖所有核心功能模块
- **性能基准**：建立性能基准，监控处理时间和效率变化
- **问题分析**：对测试中发现的问题进行深度分析，提供具体改进建议
- **报告生成**：测试报告应包含详细的数据统计、问题分析和改进建议

### 5. 规范执行监控经验
- **实时监控**：建立自动化监控工具，实时检查规范符合性
- **定期检查**：每月至少进行一次全面的规范符合性检查
- **违规处理**：发现违规立即整改，并记录违规原因和处理措施
- **预防措施**：在开发流程中嵌入规范检查环节，防止违规发生

## 🚨 规范执行监控机制

### 1. 实时监控系统
```javascript
// 规范监控脚本示例
class CodeStructureMonitor {
    constructor() {
        this.allowedExtensions = ['.js', '.ts', '.md'];
        this.forbiddenDirectories = ['src', 'dist', 'BugRecord'];
        this.testCodeDirectory = 'TestCode';
    }
    
    // 检查主目录下是否有违规文件
    checkForViolations() {
        const mainDirFiles = this.getMainDirectoryFiles();
        const violations = this.identifyViolations(mainDirFiles);
        return violations;
    }
    
    // 自动迁移违规文件
    autoMigrateViolations(violations) {
        violations.forEach(file => {
            this.moveToTestCode(file);
        });
    }
}
```

### 2. 定期检查机制
- **检查频率**：每月1日进行定期检查
- **检查范围**：主目录下所有文件
- **检查内容**：
  - 是否有测试文件放在主目录下
  - TestCode目录结构是否规范
  - 测试文件命名是否符合规范
- **检查报告**：生成详细的检查报告，记录违规情况和整改措施

### 3. 开发流程嵌入
**新的开发流程**：
1. **需求分析阶段**：确定文件类型（目标代码/测试代码）
2. **设计阶段**：确定文件存放位置（src/或TestCode/）
3. **开发阶段**：在指定目录下创建文件
4. **测试阶段**：验证规范符合性
5. **提交阶段**：通过规范检查才能提交

### 4. 违规处理流程
1. **发现违规**：通过监控工具或人工检查发现违规
2. **记录违规**：详细记录违规文件、违规类型、发现时间
3. **立即整改**：在24小时内完成违规文件的迁移
4. **原因分析**：分析违规原因，制定预防措施
5. **经验总结**：将违规案例纳入经验教训库

### 5. 预防措施
- **开发前检查**：在创建新文件前进行规范符合性检查
- **命名规范**：建立测试文件命名规范，便于识别
- **目录结构**：建立清晰的目录结构，避免文件混淆
- **培训教育**：定期进行规范培训，提高规范意识

## 🔧 使用说明

### 运行测试
```bash
# 运行单元测试
bun TestCode/scripts/test/unit/

# 运行集成测试  
bun TestCode/scripts/test/integration/

# 运行特定测试文件
bun TestCode/scripts/test/simple-test.js
```

### 添加新测试
1. 将测试脚本放入 `TestCode/scripts/`
2. 将测试数据放入 `TestCode/data/`
3. 将测试报告放入 `TestCode/reports/`

## 📊 版本历史

### 版本 2.0 (2026-01-27 22:13:30)
- **规则升级**：从目录说明升级为正式项目规范
- **内容完善**：增加执行标准、检查清单、项目经验总结
- **规范关联**：明确与代码审查、BUG修复规则的关联关系
- **目录结构**：完善TestCode目录结构，增加test-scripts、test-reports、test-results子目录

### 版本 1.0 (2026-01-27 19:43:39)
- 初始创建TestCode目录结构
- 迁移原test目录到TestCode/scripts/test/
- 建立目录规范和使用说明

## 🏆 正式规则声明

本《APP和系统陪测代码管理规则》自2026-01-27 22:13:30起正式生效，作为项目开发的重要规范之一，与《代码审查规则》、《BUG修复验证规范》共同构成项目质量保障体系。

**规则适用范围**：所有新开发项目和现有项目
**规则执行要求**：强制性执行，纳入代码审查和项目验收标准
**规则维护责任**：技术团队负责规则的持续改进和更新

---

**维护**: 技术团队  
**规则生效时间**: 2026-01-27 22:13:30  
**最后更新**: 2026-01-27 22:13:30
